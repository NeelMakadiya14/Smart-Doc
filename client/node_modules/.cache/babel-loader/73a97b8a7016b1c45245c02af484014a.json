{"ast":null,"code":"import _toConsumableArray from\"/media/neel/DATA/WebD/Smart Doc/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/media/neel/DATA/WebD/Smart Doc/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/media/neel/DATA/WebD/Smart Doc/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2;import React,{useEffect,useRef,useState}from\"react\";import io from\"socket.io-client\";import Peer from\"simple-peer\";import styled from\"styled-components\";import{CookiesProvider,Cookies,useCookies}from'react-cookie';import{Card,List,ListItem,Button,Typography,Grid,Divider,ListItemText}from'@material-ui/core';import{v1 as uuid}from\"uuid\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";require('dotenv').config();var Container=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n    padding: 20px;\\n    display: flex;\\n    height: 100vh;\\n    width: 90%;\\n    margin: auto;\\n    flex-wrap: wrap;\\n\"])));var StyledVideo=styled.video(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n    height: 40%;\\n    width: 50%;\\n\"])));var Video=function Video(props){var ref=useRef();useEffect(function(){props.peer.peer.on(\"stream\",function(stream){ref.current.srcObject=stream;});});return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(StyledVideo,{playsInline:true,autoPlay:true,ref:ref,style:{width:100+'%'}}),/*#__PURE__*/_jsx(Typography,{children:props.peer.name})]});};var videoConstraints={height:window.innerHeight/2,width:window.innerWidth/2};var AudioChannel=function AudioChannel(props){var cookies=new Cookies();var userCookie=cookies.get('userCookie');var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isAudio=_useState2[0],setAudio=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),peers=_useState4[0],setPeers=_useState4[1];var socketRef=useRef();var userVideo=useRef();var peersRef=useRef([]);var roomID=props.room;var userDetail={room:roomID,name:userCookie.name,GID:userCookie.GID};console.log(\"On Top : \",peers);useEffect(function(){window.onbeforeunload=function(){if(socketRef.current){socketRef.current.close();}setPeers([]);};});var wantsToJoin=function wantsToJoin(){socketRef.current=io.connect(\"/\");navigator.mediaDevices.getUserMedia({video:videoConstraints,audio:true}).then(function(stream){userVideo.current.srcObject=stream;socketRef.current.emit(\"join room\",userDetail);socketRef.current.on(\"all users\",function(users){var peers=[];users.forEach(function(user){var peer=createPeer(user.socketID,socketRef.current.id,stream);peersRef.current.push({peerID:user.socketID,peer:peer,name:user.name,GID:user.GID});peers.push(peer);});setPeers(peers);});socketRef.current.on(\"user joined\",function(payload){var peer=addPeer(payload.signal,payload.callerID,stream);peersRef.current.push({peerID:payload.callerID,peer:peer,name:payload.name,GID:payload.GID});setPeers(function(users){return[].concat(_toConsumableArray(users),[peer]);});});socketRef.current.on(\"receiving returned signal\",function(payload){var item=peersRef.current.find(function(p){return p.peerID===payload.id;});item.peer.signal(payload.signal);});socketRef.current.on(\"user left\",function(id){console.log(\"Called...\");var peerObj=peersRef.current.find(function(p){return p.peerID===id;});if(peerObj){peerObj.peer.destroy();}var remaining=[];peersRef.current.forEach(function(row){if(row.peerID!==id){remaining.push(row.peer);}});var peers=peersRef.current.filter(function(p){return p.peerID!==id;});peersRef.current=peers;setPeers(remaining);});});};var username_stun=process.env.USER_NAME||\"nmakadiya1@gmail.com\";var passsword_stun=process.env.PASSWORD||\"12345678\";console.log(\"Changed : \",username_stun,passsword_stun);function createPeer(userToSignal,callerID,stream){var peer=new Peer({initiator:true,trickle:false,config:{iceServers:[{urls:[\"stun:bn-turn1.xirsys.com\"]},{username:\"qHtLVEHF6H9ZmteYAHm3-qOkRrPjNYQa1Pa1IxlDpVP_KQHIVuYk-NnNtveMDgijAAAAAGBOEKJOZWVsTWFrYWRpeWE=\",credential:\"d88d47d0-84c9-11eb-a788-0242ac140004\",urls:[\"turn:bn-turn1.xirsys.com:80?transport=udp\",\"turn:bn-turn1.xirsys.com:3478?transport=udp\",\"turn:bn-turn1.xirsys.com:80?transport=tcp\",\"turn:bn-turn1.xirsys.com:3478?transport=tcp\",\"turns:bn-turn1.xirsys.com:443?transport=tcp\",\"turns:bn-turn1.xirsys.com:5349?transport=tcp\"]}]},stream:stream});peer.on(\"signal\",function(signal){socketRef.current.emit(\"sending signal\",{userToSignal:userToSignal,callerID:callerID,signal:signal,name:userCookie.name,GID:userCookie.GID});});return peer;}function addPeer(incomingSignal,callerID,stream){var peer=new Peer({initiator:false,trickle:false,config:{iceServers:[{urls:[\"stun:bn-turn1.xirsys.com\"]},{username:\"qHtLVEHF6H9ZmteYAHm3-qOkRrPjNYQa1Pa1IxlDpVP_KQHIVuYk-NnNtveMDgijAAAAAGBOEKJOZWVsTWFrYWRpeWE=\",credential:\"d88d47d0-84c9-11eb-a788-0242ac140004\",urls:[\"turn:bn-turn1.xirsys.com:80?transport=udp\",\"turn:bn-turn1.xirsys.com:3478?transport=udp\",\"turn:bn-turn1.xirsys.com:80?transport=tcp\",\"turn:bn-turn1.xirsys.com:3478?transport=tcp\",\"turns:bn-turn1.xirsys.com:443?transport=tcp\",\"turns:bn-turn1.xirsys.com:5349?transport=tcp\"]}]},stream:stream});peer.on(\"signal\",function(signal){socketRef.current.emit(\"returning signal\",{signal:signal,callerID:callerID});});peer.signal(incomingSignal);return peer;}var HandleAudio=function HandleAudio(){//Wants To Leave\nif(isAudio){window.location.reload();}//Wants to Join\nelse{wantsToJoin();setAudio(true);}};return/*#__PURE__*/_jsx(Container,{style:{height:90+'vh'},children:/*#__PURE__*/_jsxs(List,{children:[/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:HandleAudio,children:isAudio?\"Leave Stream\":\"Join Stream\"})}),isAudio?/*#__PURE__*/_jsxs(List,{children:[/*#__PURE__*/_jsx(ListItem,{className:\"video-list\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(StyledVideo,{muted:true,playsInline:true,autoPlay:true,ref:userVideo,style:{width:100+'%'}}),console.log(\"Log : \",peers,peersRef.current),/*#__PURE__*/_jsx(Typography,{children:\"You\"})]})}),console.log('PeerRef : ',peersRef.current),peersRef.current.map(function(peer,index){return/*#__PURE__*/_jsx(ListItem,{className:\"video-list\",children:/*#__PURE__*/_jsx(Video,{peer:peer},peer.peerID)},peer.peerID);})]}):null]})});};export default AudioChannel;","map":{"version":3,"sources":["/media/neel/DATA/WebD/Smart Doc/client/src/routes/AudioChannel.js"],"names":["React","useEffect","useRef","useState","io","Peer","styled","CookiesProvider","Cookies","useCookies","Card","List","ListItem","Button","Typography","Grid","Divider","ListItemText","v1","uuid","require","config","Container","div","StyledVideo","video","Video","props","ref","peer","on","stream","current","srcObject","width","name","videoConstraints","height","window","innerHeight","innerWidth","AudioChannel","cookies","userCookie","get","isAudio","setAudio","peers","setPeers","socketRef","userVideo","peersRef","roomID","room","userDetail","GID","console","log","onbeforeunload","close","wantsToJoin","connect","navigator","mediaDevices","getUserMedia","audio","then","emit","users","forEach","user","createPeer","socketID","id","push","peerID","payload","addPeer","signal","callerID","item","find","p","peerObj","destroy","remaining","row","filter","username_stun","process","env","USER_NAME","passsword_stun","PASSWORD","userToSignal","initiator","trickle","iceServers","urls","username","credential","incomingSignal","HandleAudio","location","reload","map","index"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport io from \"socket.io-client\";\nimport Peer from \"simple-peer\";\nimport styled from \"styled-components\";\nimport { CookiesProvider, Cookies,useCookies } from 'react-cookie';\nimport{ Card, List, ListItem,Button,Typography, Grid, Divider, ListItemText} from '@material-ui/core';\nimport { v1 as uuid } from \"uuid\";\nrequire('dotenv').config();\n\nconst Container = styled.div`\n    padding: 20px;\n    display: flex;\n    height: 100vh;\n    width: 90%;\n    margin: auto;\n    flex-wrap: wrap;\n`;\n\nconst StyledVideo = styled.video`\n    height: 40%;\n    width: 50%;\n`;\n\nconst Video = (props) => {\n    const ref = useRef();\n\n    useEffect(() => {\n        props.peer.peer.on(\"stream\", stream => {\n            ref.current.srcObject = stream;\n        })\n    });\n\n    return (\n        <div>\n            <StyledVideo playsInline autoPlay ref={ref} style={{width:100+'%'}} />\n            <Typography>{props.peer.name}</Typography>\n        </div>\n        \n    );\n}\n\n\nconst videoConstraints = {\n    height: window.innerHeight / 2,\n    width: window.innerWidth / 2\n};\n\nconst AudioChannel = (props) => {\n\n    const cookies = new Cookies();\n    const userCookie=cookies.get('userCookie');\n\n    const [isAudio,setAudio]=useState(false);\n    const [peers, setPeers] = useState([]);\n    const socketRef = useRef();\n    const userVideo = useRef();\n    const peersRef = useRef([]);\n    const roomID = props.room;\n\n    const userDetail={\n        room:roomID,\n        name:userCookie.name,\n        GID:userCookie.GID\n    }\n\n    console.log(\"On Top : \",peers);\n\n    useEffect(()=>{\n         window.onbeforeunload =()=>{\n            if(socketRef.current){\n                socketRef.current.close();\n            } \n            setPeers([]);\n         }\n    })\n\n    const wantsToJoin=()=>{\n        socketRef.current = io.connect(\"/\");\n        navigator.mediaDevices.getUserMedia({ video: videoConstraints, audio: true }).then(stream => {\n            userVideo.current.srcObject = stream;\n            socketRef.current.emit(\"join room\", userDetail);\n            socketRef.current.on(\"all users\", users => {\n                const peers = [];\n                users.forEach(user => {\n                    const peer = createPeer(user.socketID, socketRef.current.id, stream);\n                    peersRef.current.push({\n                        peerID: user.socketID,\n                        peer,\n                        name:user.name,\n                        GID:user.GID\n                    })\n                    peers.push(peer);\n                })\n                setPeers(peers);\n            })\n\n            socketRef.current.on(\"user joined\", payload => {\n                const peer = addPeer(payload.signal, payload.callerID, stream);\n                peersRef.current.push({\n                    peerID: payload.callerID,\n                    peer,\n                    name:payload.name,\n                    GID:payload.GID\n                })\n\n                setPeers(users => [...users, peer]);\n            });\n\n            socketRef.current.on(\"receiving returned signal\", payload => {\n                const item = peersRef.current.find(p => p.peerID === payload.id);\n                item.peer.signal(payload.signal);\n            });\n\n            socketRef.current.on(\"user left\",id=>{\n                console.log(\"Called...\");\n                const peerObj=peersRef.current.find(p=>p.peerID===id);\n                if(peerObj){\n                    peerObj.peer.destroy();\n                }\n                let remaining=[];\n                peersRef.current.forEach(row=>{\n                    if(row.peerID!==id){\n                        remaining.push(row.peer);\n                    }\n                })\n                const peers = peersRef.current.filter(p=>p.peerID!==id);\n                peersRef.current=peers;\n                setPeers(remaining);\n            })\n\n        })\n    }\n\n    const username_stun=process.env.USER_NAME || \"nmakadiya1@gmail.com\";\n    const passsword_stun=process.env.PASSWORD || \"12345678\";\n\n    console.log(\"Changed : \",username_stun,passsword_stun);\n\n     function createPeer(userToSignal, callerID, stream) {\n        const peer = new Peer({\n            initiator: true,\n            trickle: false,\n              config: {\n                iceServers: [{   \n                    urls: [ \"stun:bn-turn1.xirsys.com\" ]\n                }, \n                {   \n                    username: \"qHtLVEHF6H9ZmteYAHm3-qOkRrPjNYQa1Pa1IxlDpVP_KQHIVuYk-NnNtveMDgijAAAAAGBOEKJOZWVsTWFrYWRpeWE=\",   \n                    credential: \"d88d47d0-84c9-11eb-a788-0242ac140004\",   \n                    urls: [       \n                        \"turn:bn-turn1.xirsys.com:80?transport=udp\",       \n                        \"turn:bn-turn1.xirsys.com:3478?transport=udp\",       \n                        \"turn:bn-turn1.xirsys.com:80?transport=tcp\",       \n                        \"turn:bn-turn1.xirsys.com:3478?transport=tcp\",       \n                        \"turns:bn-turn1.xirsys.com:443?transport=tcp\",       \n                        \"turns:bn-turn1.xirsys.com:5349?transport=tcp\"   \n                    ]\n                }],\n            },\n            stream,\n        });\n\n\n        peer.on(\"signal\", signal => {\n            socketRef.current.emit(\"sending signal\", { userToSignal, callerID, signal,name:userCookie.name, GID:userCookie.GID })\n        })\n\n        return peer;\n    }\n\n    function addPeer(incomingSignal, callerID, stream) {\n        const peer = new Peer({\n            initiator: false,\n            trickle: false,\n              config: {\n                iceServers: [{   \n                    urls: [ \"stun:bn-turn1.xirsys.com\" ]\n                }, \n                {   \n                    username: \"qHtLVEHF6H9ZmteYAHm3-qOkRrPjNYQa1Pa1IxlDpVP_KQHIVuYk-NnNtveMDgijAAAAAGBOEKJOZWVsTWFrYWRpeWE=\",   \n                    credential: \"d88d47d0-84c9-11eb-a788-0242ac140004\",   \n                    urls: [       \n                        \"turn:bn-turn1.xirsys.com:80?transport=udp\",       \n                        \"turn:bn-turn1.xirsys.com:3478?transport=udp\",       \n                        \"turn:bn-turn1.xirsys.com:80?transport=tcp\",       \n                        \"turn:bn-turn1.xirsys.com:3478?transport=tcp\",       \n                        \"turns:bn-turn1.xirsys.com:443?transport=tcp\",       \n                        \"turns:bn-turn1.xirsys.com:5349?transport=tcp\"   \n                    ]\n                }],\n            },\n            stream,\n        })\n\n        peer.on(\"signal\", signal => {\n            socketRef.current.emit(\"returning signal\", { signal, callerID })\n        })\n\n        peer.signal(incomingSignal);\n\n        return peer;\n    }\n\n    const HandleAudio=()=>{\n        //Wants To Leave\n        if(isAudio){\n            window.location.reload();\n        }\n        //Wants to Join\n        else{\n            wantsToJoin();\n            setAudio(true);\n        }\n\n    }\n   \n    return (\n         <Container style={{height:90+'vh'}}>\n            <List>\n                <ListItem>\n                    <Button variant=\"contained\" color=\"primary\" onClick={HandleAudio}>\n                        {isAudio?\"Leave Stream\":\"Join Stream\"}\n                    </Button>\n                    </ListItem>\n\n                    {isAudio?<List>\n                    <ListItem className=\"video-list\">\n                        <div>\n                            <StyledVideo muted playsInline autoPlay ref={userVideo} style={{width:100+'%'}}/>\n                            {console.log(\"Log : \",peers,peersRef.current)}\n                            <Typography>You</Typography>\n                        </div>\n                    </ListItem>\n                            {console.log('PeerRef : ',peersRef.current)}\n                            {peersRef.current.map((peer, index) => {\n                            return (\n\n                                <ListItem className=\"video-list\" key={peer.peerID}>\n                                    <Video key={peer.peerID} peer={peer} />\n                                </ListItem>\n                            );\n                        })}\n                        </List>:null}\n            </List> \n           \n            \n        </Container>\n    );\n};\n\n\n\n\n\nexport default AudioChannel;\n"]},"metadata":{},"sourceType":"module"}